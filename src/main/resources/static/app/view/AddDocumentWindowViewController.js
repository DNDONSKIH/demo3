/*
 * File: app/view/AddDocumentWindowViewController.js
 *
 * This file was generated by Sencha Architect version 4.2.5.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 6.6.x Classic library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 6.6.x Classic. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.AddDocumentWindowViewController', {
    extend: 'Ext.app.ViewController',
    alias: 'controller.adddocumentwindow',

    onCancelButtonClick: function(button, e, eOpts) {
        this.getView().close();
    },

    onAddButtonClick: function(button, e, eOpts) {
        const addDocumentWindow = this.lookupReference('NewDocomentWindow');
        const addDocumentWindow2 = Ext.getCmp('newDocomentWindow');
        const form = this.lookupReference('AddDocumentForm').getForm();
        const formValues = form.getValues();

        if (form.isValid()) {
            form.submit({
                success: function(form, action) {
                    form.reset();

                    addDocumentWindow2.close(); //button.up('window').close(); //тоже работает
                    //addDocumentWindow.close(); //не работает, почему null???

                    const myStore = Ext.data.StoreManager.lookup('DocumentsStore');
                    myStore.reload();
                },
                failure: function(form, action) {
                    switch (action.failureType) {
                        case Ext.form.action.Action.CLIENT_INVALID:
                        Ext.Msg.alert('Failure', 'Form fields may not be submitted with invalid values');
                        break;
                        case Ext.form.action.Action.CONNECT_FAILURE:
                        Ext.Msg.alert('Failure', 'Ajax communication failed');
                        break;
                        case Ext.form.action.Action.SERVER_INVALID:
                        Ext.Msg.alert('Failure', action.result.msg);
                    }
                }
            });

            //     Ext.Ajax.request({
            //                 		url:'/api/documents',
            //                 		method: 'POST',
            //                 		params: formValues
            //                 	});

            //     const newDocument = Ext.create('MyApp.model.Document', formValues );
            //     const documentsStore = Ext.data.StoreManager.lookup('DocumentsStore');
            //     documentsStore.add(newDocument);
        }
        else{
            Ext.Msg.alert('Ошибка!', 'Проверьте правильность введенных данных!');
        }

    }

});
